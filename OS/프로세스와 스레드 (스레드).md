## 프로세스와 스레드 (스레드)

### 스레드와 멀티스레딩

**스레드**

`프로세스의 실행 가능한 가장 작은 단위`

특징) <br>
스레드의 코드, 데이터, 힙 영역은 서로 공유함 <br>
스택 영역 등은 각각 생성됨

<br>

**멀티스레딩**

프로세스 내 작업을 `여러 개의 스레드`로 처리하는 기법

    장점)
    1. 효율성 높음: 스레드끼리 서로 자원을 공유하기 때문에
    2. 동시성: 한 스레드가 중단되어도 다른 스레드는 실행 상태일 수 있기 때문에

    ※ 동시성: 서로 독립적인 작업들을 작은 단위로 나누고 동시에 실행되는 것처럼 보여주는 것

    단점)
    1. 프로세스에 영향: 한 스레드에 문제가 생기면 다른 스레드에도 영향을 끼쳐 해당 프로세스에 영향을 줄 수 있음

    예시) 웹 브라우저의 '렌더러 프로세스'
    메인 + 워커 + 컴포지터 + 레스터 스레드로 구성됨

<br>

### 공유 자원과 임계 영역

**공유 자원 (shared resource)**

    시스템 안에서 각 프로세스, 스레드가 '함께 접근할 수 있는' 자원이나 변수

    ex) 모니터, 프린터, 메모리, 파일, 데이터 등

    경쟁 상태 (race condition)
    두 개 이상의 프로세스가 '공유 자원'을 '동시에' 읽거나 쓰는 상황

**임계 영역 (critical section)**

    둘 이상의 프로세스, 스레드가 '공유 자원'에 접근할 때,
    '순서 등의 이유'로 결과가 달라지는 코드 영역
    
    [해결 방법]
    1. 뮤텍스
    2. 세마포어
    3. 모니터
    
    위 3가지 방법 모두
    1) 상호 배제 (mutual exclusion)
    한 프로세스가 임계 영역에 들어갔을 때, 다른 프로세스는 들어갈 수 없음

    2) 한정 대기 (bounded waiting)
    특정 프로세스가 영원히 임계 영역에 들어가지 못하면 안됨

    3) 융통성 (progress)
    만약 어떤 프로세스도 임계 영역을 사용하지 않는다면,
    외부의 어떤 프로세스도 들어갈 수 있고 이 때 프로세스끼리 서로 방해하면 안됨

    위 3가지 조건들을 만족함

**뮤텍스 (mutex)**

    공유 자원을 lock()을 통해 잠금 설정
    사용한 후에는 unlock()을 통한 잠금 해제하는 '객체'

    뮤텍스는 잠금 or 잠금 해제란 상태만을 가짐

**세마포어 (semaphore)**

    간단한 정수 값 + 두 가지 함수 (wait, signal)로 '공유 자원에 대한 접근을 처리'하는 일반화된 뮤텍스

    1. wait() (P 함수): 자신의 차례가 올 때까지 기다리는 함수
    2. signal() (V 함수): 다음 프로세스로 순서를 넘겨주는 함수

    공유 자원에 접근하면, wait() 작업 수행
    공유 자원을 해제하면, signal() 작업을 수행

    특징)
    1. 조건 변수가 없음
    2. 동시에 세마포어의 값을 수정할 수 없음

**바이너리 세마포어**

    0과 1의 두 가지 값만 가질 수 있는 세마포어

    바이너리 세마포어는 뮤텍스라 할 수 있지만,
    뮤텍스: 잠금을 기반으로 상호 배제가 일어나는 '잠금 메커니즘'
    세마포어: 신호를 기반으로 상호 배제가 일어나는 '신호 메커니즘'

**카운팅 세마포어**

    '여러 개의 값'을 가질 수 있는 세마포어

    '여러 자원에 대한 접근'을 제어하는 데 사용됨

**모니터**

    둘 이상의 프로세스 or 스레드가 '공유 자원'에 '안전'하게 접근할 수 있도록
    1. 공유 자원을 숨김
    2. 해당 접근에 대해 인터페이스만 제공

    모니터는 '모니터 큐'를 통해 공유 자원에 대한 작업들을 순차적으로 처리함
    따라서 모니터에서 상호 배제는 자동임
    반면, 세마포어의 상호 배제는 명시적으로 구현해야함

<br>

### 교착 상태 (deadlock)

    두 개 이상의 프로세스들이 서로가 가진 자원을 기다리며 중단된 상태

    원인)
    1. 상호 배제: 한 프로세스가 자원을 독점하고 다른 프로세스들은 접근이 불가능함
    2. 점유 대기: 특정 프로세스가 점유한 자원을 다른 프로세스가 요청하는 상황
    3. 비선점: 다른 프로세스의 자원을 강제적으로 가져올 수 없음
    4. 환형 대기: 각각 자원을 점유한 두 프로세스가 서로 상대 자원을 요구하는 상황

    해결 방법)
    1. 교착 상태 원인들이 성립되지 않게 설계
    2. 교착 상태 가능성이 없을 때만 자원을 할당, 은행원 알고리즘을 사용함
    3. 교착 상태가 발생하면 '사이클'이 있는지 확인하고 관련된 프로세스를 한 개씩 지움
    4. 사용자가 작업을 종료하는 방법 (현대 운영체제의 해결법)
    교착 상태는 드물게 일어나는 반면 처리 비용은 커서 교착 상태가 발생하면 사용자가 종료
    ex. '응답 없음' 상태창

    ※ 은행원 알고리즘
    총 자원의 양 & 현재 할당된 자원의 양을 기준으로 안정 or 불안정 상태로 나누고
    안정 상태로 가도록 자원을 할당하는 알고리즘
    
